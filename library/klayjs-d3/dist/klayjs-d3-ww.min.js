/*! klayjs-d3 version 0.3.4 build 201512301212*/
var klay;!function(a){function b(a){function b(a){var b=l/a.width||1,d=m/a.height||1;b>d&&(b=d),c&&c.attr("transform","scale("+b+")")}var c,d={},e=d3.dispatch("finish"),f=[],g=[],h={},i=function(a){return a.ports||[]},j=function(a){return a.labels||[]},k={},l=0,m=0,n=[10,10],o=[4,4],p=["x","y","width","height","sourcePoint","targetPoint","properties"].reduce(function(a,b){return a[b]=1,a},{}),q=function(){},r=function(){for(var a=document.getElementsByTagName("script"),b=0;b<a.length;++b)if(a[b].src.indexOf("klay.js")>-1)return a[b].src;throw"klay.js library wasn't loaded!"},s={};if("undefined"==typeof window||"function"!=typeof window.Worker)return window.alert("WebWorker not supported by browser."),{};var t=new Worker(r()),s={layout:function(a){t.postMessage({graph:a.graph,options:a.options})}};if(t.addEventListener("message",function(a){h=a.data,q(h)},!1),d.size=function(a){return arguments.length?(l=a[0],m=a[1],d):[l,m]},d.transformGroup=function(a){return arguments.length?(c=a,d):c},d.options=function(a){return arguments.length?(k=a,d):k},"adapter"===a){d.nodes=function(a){return arguments.length?(f=a,d):f},d.ports=function(a){return arguments.length?(i=a,d):i},d.links=function(a){return arguments.length?(g=a,d):g},d.defaultNodeSize=function(a){return arguments.length?(n=a,d):n},d.defaultPortSize=function(a){return arguments.length?(o=a,d):o},d.start=function(){return f.forEach(function(a,b){a.width=a.width||n[0],a.height=a.height||n[1],a.id=""+(a.id||b),a.ports=i(a),a.ports.forEach(function(a){a.width=a.width||o[0],a.height=a.height||o[1]}),a.labels=j(a)}),g.forEach(function(a,b){a.id=""+(a.id||b+f.length),a.source=""+a.source,a.target=""+a.target}),q=u,s.layout({graph:{id:"root",children:f,edges:g},options:k,success:function(a){h=a,q(a)},error:function(a){console.error(a)}}),d};var u=function(a){function c(a,b,c){var d=p;c&&(d=c.reduce(function(a,b){return a[b]=1,a},{}));for(var e in a)d[e]&&(b[e]=a[e])}a&&(b(a),a.children.forEach(function(a){var b=f[parseInt(a.id)];c(a,b),(a.ports||[]).forEach(function(a,d){c(a,b.ports[d])}),(a.labels||[]).forEach(function(a,d){c(a,b.labels[d])})}),a.edges.forEach(function(a){var b=g[parseInt(a.id)-f.length];c(a,b),c(a.source,b.source),c(a.target,b.target),b.bendPoints=a.bendPoints||[]})),e.finish({graph:a})}}if("kgraph"===a){d.nodes=function(){for(var a,b=[h],c=[];null!=(a=b.pop());)c.push(a),(a.children||[]).forEach(function(a){b.push(a)});return c},d.links=function(a){return d3.merge(a.map(function(a){return a.edges||[]}))},d.kgraph=function(a){return q=v,s.layout({graph:a,options:k,success:function(a){h=a,q(a)},error:function(a){console.error(a)}}),d};var v=function(a){b(a);var c={};w(a,{x:0,y:0},c),y(a,c),e.finish({graph:a})},w=function(a,b,c){a.x=(a.x||0)+b.x,a.y=(a.y||0)+b.y,c[a.id]=a,(a.children||[]).forEach(function(b){b.parent=a,w(b,{x:a.x,y:a.y},c)})},x=function(a,b){for(var c=b.parent;c;){if(c==a)return!0;c=c.parent}return!1},y=function(a,b){(a.edges||[]).forEach(function(a){var c=b[a.source],d=b[a.target],e=x(c,d)?c:c.parent,f={x:0,y:0};e&&(f.x=e.x,f.y=e.y),a.sourcePoint&&(a.sourcePoint.x+=f.x||0,a.sourcePoint.y+=f.y||0),a.targetPoint&&(a.targetPoint.x+=f.x||0,a.targetPoint.y+=f.y||0),(a.bendPoints||[]).forEach(function(a){a.x+=f.x,a.y+=f.y})}),(a.children||[]).forEach(function(a){y(a,b)})}}return d3.rebind(d,e,"on")}return a.d3adapter=function(){return b("adapter")},a.d3kgraph=function(){return b("kgraph")},"object"==typeof module&&module.exports&&(module.exports=a),a}(klay||(klay={}));